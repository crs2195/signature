As remote signatures are increasingly used, by transferring processing logic to the cloud infrastructure, this repository contains examples of 'how to' sign in the cloud, using popular digital signature APIs such as iText, SecureBlackBox and PDFBox. These applications allow the remote signing of documents in PDF format, offering a simple user access interface (currently, these APIs perform the signing of a document, working with private keys stored in Java KeyStore). Project implementation is based on protocols defined by the CSC (Cloud Signature Consortium) standard, which proposes standardization to establish interoperable solutions for cloud-based digital signatures. The application integrates the hash of the document signed remotely by the remote server with CSC, by making a call to the APIs. Thus, the digital signature process is reduced to standard authentication and secure data transfer, in order to sign a document the user is only required to authenticate in the application based on the credentials, registered with the CA.


iText
iText PDF is a SDK offered under the AGPL license for generating, programming and manipulating PDF documents, and is available for both Java and .NET frameworks.
In order to interact with iText 7 with an existing PDF document for the purpose of signing it, PdfReader and PdfSigner objects are required to extract the bits of the document and to define the signature details, with a specialized PDFSignatureAppearance class. 
The signature request is made from the SignDetached method, from the PdfSigner class, that signs the document using the detached, CMS or CadES equivalent mode. The most important parameter of the method is an iTextSignature object, which implements the IExternalSignature interface, and overrides its methods (Sign, GetEncryptionAlgorithm, GetSigningAlgorithm). Also, the list of X509Certificate (Bouncy Castle class) certificates is required and the type of signature. 
The method can also receive a certificate revocation list (CRL), an Online Certificate Status Protocol (OCSP) client and a timestamp client. The overwritten methods are executed without their explicit call, but implicitly by the SDK, within the SignDetached method. The Sign method requests the signature bytes from the remote digital signature web service exposed by the TSP, then returns them, in order to be added to the reserved space for the signature, in the SignDetached method. 
The computation of a remote digital signature for a PDF document is also possible using the 5th version of iText, which has some different classes, but the implementation is similar.

PDFBox
Apache PDFBox is an open source Java library for working with PDF documents, which allows the creation of new PDF documents, manipulation of existing documents, the possibility to extract content from documents, as well as digitally signing documents.
For the interaction with PDF documents within the PDFBox API, the specific class PDDocument is used. The first step in creating the signature is to create the signing service - a class that must implement the interface SignatureInterface, and involves overwriting the Sign method. Next, the document is prepared for signing, by instantiating an object of the ExternalSigningSupport class. This object allows the extraction of the content of the document (data to be signed), in the form of InputStream, which is sent as parameter to the explicit call of the Sign method.
Bouncy Castle classes are used in the Sign method. First of all, a CMSSignedDataGenerator object has to be instantiated, which is meant to compute the signature using a private key stored in a specific KeyStore. For implementing remote digital signing, there is no KeyStore, therefore a PKCS#7 signature with the already signed data has to be created. In order to do this, a ContentSigner object has to be instantiated (interface for an operator that is capable of creating a signature), which  requires overwriting the GetSignature method that returns the signed bytes received from the remote digital signature web service exposed by the TSP. A new generator (SignerInfoGenerator - used for a particular signatory, namely the previously created ContentSigner) is added to the CMSSignedDataGenerator.
When calling, from the CMSSignedDataGenerator, the method which generates the signature, it is necessary to send as parameter an array of bytes, which will not be used. The SDK checks for a SignerInfoGenerator object. If such an object exists for the corresponding generator, the GetSignature method, that has been overwritten, shall be called. It will return
the bytes of the signature in a CMSSignedData object, along with the digital certificate associated to the user that requested the sign. The Sign method returns the object, encoded in ASN.1 format. The last step is to set those bytes in the PDF document. 



SecureBlackBox
SecureBlackbox is an open source library which allows basic operations on PDF documents (metadata extraction, content extraction, creation, writing), and includes components  and functions used to ensure the security of PDF documents (allows operations for signing, encryption, decryption). SecureBlackBox defines specialized classes for each component used for signing.
To interact with the PDF documents, the SDK provides the TelPDFDocument class. The first step after the document is loaded is to add the signature and its properties through a TElPDFSignature object. A TElPDFAdvancedPublicKeySecurityHandler security handler must be assigned to the signature, allowing the signing and validation of PAdES signatures.
The handler allows setting different properties, such as the type of signature, the way in which the validation of the certificates will be done (Adobe.PPKLITE - determines the Adobe tools to look for the internal certificate, and Adobe.PPKMS - in the storage of the Windows certificates), the certificate chain as TElX509Certificate objects, a time stamp client etc. 
To delegate the signing operation to an external source, a property of the handler specifying whether the signingwill be done remotely is set to true and a handler will be assigned to the OnRemoteSign event, namely OnRemoteSign method, which takes in the hash of the document, computes the corresponding signature by calling the remote digital signature  web service exposed by the TSP and returns it. The method is automatically called when saving and closing the document.


